<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ªïng quan - Blue Moon</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">Blue Moon - H·ªá th·ªëng qu·∫£n l√Ω chung c∆∞</h1>
            <div class="nav-user">
                <span th:text="${user.fullName}">Ng∆∞·ªùi d√πng</span>
                <a th:href="@{/logout}" class="btn btn-sm">ƒêƒÉng xu·∫•t</a>
            </div>
        </div>
    </nav>
    
    <div class="dashboard-container">
        <div style="display: flex; gap: 20px;">
            <!-- Sidebar Menu -->
            <aside class="sidebar" style="width: 250px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); height: fit-content;">
                <h3 style="margin-bottom: 20px; color: #667eea;">Menu</h3>
                <ul class="menu" style="list-style: none; padding: 0;">
                    <li th:if="${permissions.contains('RESIDENT_MANAGEMENT')}">
                        <a th:href="@{/residents}" style="display: block; padding: 12px; color: #333; text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background 0.3s;">
                            üë• Qu·∫£n l√Ω nh√¢n kh·∫©u
                        </a>
                    </li>
                    <li th:if="${permissions.contains('FEE_TYPE_MANAGEMENT')}">
                        <a th:href="@{/fee-types}" style="display: block; padding: 12px; color: #333; text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background 0.3s;">
                            üí∞ Qu·∫£n l√Ω kho·∫£n thu
                        </a>
                    </li>
                    <li>
                        <a th:href="@{/fees}" style="display: block; padding: 12px; color: #333; text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background 0.3s;">
                            üìã Qu·∫£n l√Ω thu ph√≠
                        </a>
                    </li>
                    <li>
                        <a th:href="@{/statistics}" style="display: block; padding: 12px; color: #333; text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background 0.3s;">
                            üìä Th·ªëng k√™
                        </a>
                    </li>
                    <li th:if="${permissions.contains('USER_MANAGEMENT')}">
                        <a th:href="@{/users}" style="display: block; padding: 12px; color: #333; text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background 0.3s;">
                            üë§ Qu·∫£n l√Ω ng∆∞·ªùi d√πng
                        </a>
                    </li>
                    <li>
                        <a th:href="@{/personal-info}" style="display: block; padding: 12px; color: #333; text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background 0.3s;">
                            ‚ÑπÔ∏è Th√¥ng tin c√° nh√¢n
                        </a>
                    </li>
                </ul>
            </aside>
            
            <!-- Main Content -->
            <div style="flex: 1;">
                <!-- Navigation Tabs -->
                <ul class="nav-tabs">
                    <li><a href="/main" class="active">T·ªïng quan</a></li>
                    <li th:if="${permissions.contains('RESIDENT_MANAGEMENT')}"><a href="/residents">C∆∞ d√¢n</a></li>
                    <li><a href="/fees">Ho·∫°t ƒë·ªông</a></li>
                    <li><a href="/statistics">Th·ªëng k√™</a></li>
                    <li><a href="/fees">H√≥a ƒë∆°n</a></li>
                </ul>
                
                <div style="background: white; padding: 20px; border-radius: 0 0 10px 10px;">
            <!-- Key Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">üè†</div>
                    <div class="metric-value" th:text="${stats != null ? stats.totalApartments : 0}">0</div>
                    <div class="metric-label">CƒÉn h·ªô</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üë•</div>
                    <div class="metric-value" th:text="${stats != null ? stats.totalHouseholds : 0}">0</div>
                    <div class="metric-label">H·ªô gia ƒë√¨nh</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">‚ö°</div>
                    <div class="metric-value" th:text="${stats != null ? stats.totalFees : 0}">0</div>
                    <div class="metric-label">ƒêi·ªán n∆∞·ªõc</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üí∞</div>
                    <div class="metric-value" th:text="${stats != null ? (#numbers.formatDecimal(stats.totalAmount, 0, 'COMMA', 0, 'POINT') + ' ƒë') : '0 ƒë'}">0 ƒë</div>
                    <div class="metric-label">T·ªïng thu</div>
                </div>
            </div>
            
            <!-- Chart and Info Panels -->
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; margin-top: 20px;">
                <!-- Population Fluctuation Chart -->
                <div class="chart-container" style="max-width: 100%; overflow: hidden;">
                    <div class="chart-title">Bi·∫øn ƒë·ªông d√¢n c∆∞</div>
                    <div style="position: relative; height: 250px; width: 100%;">
                        <canvas id="populationChart"></canvas>
                    </div>
                </div>
                
                <!-- Revenue Summary -->
                <div class="revenue-summary">
                    <div class="revenue-value" th:text="${stats != null ? (#numbers.formatDecimal(stats.paidAmount, 0, 'COMMA', 0, 'POINT') + ' ƒë') : '0 ƒë'}">0 ƒë</div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                        <span>T·ªïng thu</span>
                        <span>ƒê∆°n v·ªã</span>
                    </div>
                </div>
            </div>
            
            <!-- Info Panels -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <!-- Recent Fee Updates -->
                <div class="info-panel">
                    <h3>C√°c kho·∫£n thu m·ªõi c·∫≠p nh·∫≠t</h3>
                    <div th:if="${stats != null and stats.recentFees != null and !stats.recentFees.isEmpty()}">
                        <div class="info-row" th:each="fee : ${stats.recentFees}">
                            <span class="label" th:text="${fee.reason != null ? fee.reason : 'Ph√≠ ƒë·ªãnh k·ª≥'}">Ti·ªÅn ƒëi·ªán</span>
                            <span class="value" th:text="${#numbers.formatDecimal(fee.amount, 0, 'COMMA', 0, 'POINT')}">100.000</span>
                        </div>
                    </div>
                    <div th:if="${stats == null or stats.recentFees == null or stats.recentFees.isEmpty()}">
                        <div class="info-row">
                            <span class="label">Ch∆∞a c√≥ d·ªØ li·ªáu</span>
                        </div>
                    </div>
                </div>
                
                <!-- Population Fluctuation Info -->
                <div class="info-panel">
                    <h3>Bi·∫øn ƒë·ªông d√¢n c∆∞</h3>
                    <div class="info-row">
                        <span class="label">H·ªô gia</span>
                        <span class="value" th:text="${stats != null ? stats.totalHouseholds : 0}">10</span>
                    </div>
                    <div class="info-row">
                        <span class="label">H·ªô m·ªõi</span>
                        <span class="value">0</span>
                    </div>
                    <div class="info-row">
                        <span class="label">H·ªô xu·∫•t</span>
                        <span class="value">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <a th:if="${permissions.contains('CAN_COLLECT_FEE')}" href="/fees" class="btn btn-primary" style="flex: 1; text-align: center; padding: 15px;">Thu ph√≠</a>
                <a th:if="${permissions.contains('FEE_TYPE_MANAGEMENT')}" href="/fee-types" class="btn btn-primary" style="flex: 1; text-align: center; padding: 15px;">Qu·∫£n l√Ω kho·∫£n thu</a>
                <a href="/statistics" class="btn btn-primary" style="flex: 1; text-align: center; padding: 15px;">Th·ªëng k√™</a>
            </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Population Chart
        const ctx = document.getElementById('populationChart');
        if (ctx) {
            const populationData = {
                labels: ['Thg 1', 'Thg 2', 'Thg 3', 'Thg 4', 'Thg 5', 'Thg 6', 'Thg 7'],
                datasets: [{
                    label: 'S·ªë h·ªô',
                    data: [10, 12, 11, 13, 12, 14, 13],
                    backgroundColor: '#667eea',
                    borderColor: '#5568d3',
                    borderWidth: 1
                }]
            };
            
            new Chart(ctx, {
                type: 'bar',
                data: populationData,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>


